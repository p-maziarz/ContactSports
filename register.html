<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Register | Contact Sports</title>
</head>
<body>
    <header>
        <h1>Contact Sports</h1>
    </header>

    <section id="main-content">
        <div class="register-content">
            <h2 class="page-title">Register</h2>
            <form id="register-form">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>

                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="firstName">First Name:</label>
                <input type="text" id="firstName" name="firstName" required>

                <label for="lastName">Last Name:</label>
                <input type="text" id="lastName" name="lastName" required>

                <button type="submit" class="button">Register</button>
            </form>

            <!-- Back button to revert to the main page -->
            <a href="index.html" class="button">Back</a>
        </div>
    </section>

    <footer>
        <p>&copy; 2024 Contact Sports Inc.</p>
    </footer>

    <script src="script.js"></script>
    <!-- Include Firebase SDK if not already included -->
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

        // Your web app's Firebase configuration (same as script.js)
        const firebaseConfig = {
            apiKey: "AIzaSyAw1eBrMaWdS9gTWgcTogeqEOVo86Rq0Xo",
            authDomain: "consportsdata.firebaseapp.com",
            projectId: "consportsdata",
            storageBucket: "consportsdata.appspot.com",
            messagingSenderId: "942262562721",
            appId: "1:942262562721:web:1fd5edc57737711926e5e0",
            measurementId: "G-E4QRPDHZG0"
        };

        // Initialize Firebase (you may check if it's already initialized to avoid conflicts)
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // Initialize Cloud Firestore and get a reference to the service
        const db = getFirestore(app);

        // Form submission event for register form
        document.addEventListener('DOMContentLoaded', function () {
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.addEventListener('submit', async function (event) {
                    event.preventDefault(); // Prevent default form submission

                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;
                    const email = document.getElementById('email').value;
                    const firstName = document.getElementById('firstName').value;
                    const lastName = document.getElementById('lastName').value;

                    try {
                        // Check if the username already exists in the Firestore collection
                        const usersCollection = collection(db, 'users');
                        const querySnapshot = await getDocs(usersCollection);
                        const existingUser = querySnapshot.docs.find(doc => {
                            const userData = doc.data();
                            return userData.username === username;
                        });

                        if (existingUser) {
                            alert('Username already exists. Please choose a different username.'); // Replace with actual logic
                        } else {
                            // Add the user registration logic here
                            // For example, add the user data to your Firebase Firestore
                            await addDoc(usersCollection, {
                                username,
                                password,
                                email,
                                firstName,
                                lastName
                                // Add other user data as needed
                            });

                            alert('Registration successful!'); // Replace with actual logic
                        }
                    } catch (error) {
                        console.error('Registration error: ', error);
                        alert('Registration failed. Please try again.'); // Replace with actual logic
                    }
                });
            }
        });
    </script>
</body>
</html>
